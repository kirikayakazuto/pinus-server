"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Container to be used by this library for inversion control. If container was not implicitly set then by default
 * container simply creates a new instance of the given class.
 */
exports.defaultContainer = new (class {
    constructor() {
        this.instances = [];
    }
    get(someClass) {
        let instance = this.instances.find(instance => instance.type === someClass);
        if (!instance) {
            instance = { type: someClass, object: new someClass() };
            this.instances.push(instance);
        }
        return instance.object;
    }
    unbind(someClass) {
        let idx = this.instances.findIndex(instance => instance.type === someClass);
        if (idx >= 0) {
            this.instances.splice(idx, 1);
        }
    }
})();
let userContainer;
let userContainerOptions;
/**
 * Sets container to be used by this library.
 */
function useContainer(iocContainer, options) {
    userContainer = iocContainer;
    userContainerOptions = options;
}
exports.useContainer = useContainer;
function isUseContainer() {
    return userContainer !== undefined;
}
exports.isUseContainer = isUseContainer;
/**
 * Gets the IOC container used by this library.
 */
function getFromContainer(someClass) {
    if (userContainer) {
        try {
            const instance = userContainer.get(someClass);
            if (instance)
                return instance;
            if (!userContainerOptions || !userContainerOptions.fallback)
                return instance;
        }
        catch (error) {
            if (!userContainerOptions || !userContainerOptions.fallbackOnErrors)
                throw error;
        }
    }
    return exports.defaultContainer.get(someClass);
}
exports.getFromContainer = getFromContainer;
/**
 * Remove object from the IOC container used by this library.
 */
function removeFromContainer(someClass) {
    if (userContainer) {
        try {
            userContainer.unbind(someClass);
        }
        catch (error) {
            if (!userContainerOptions || !userContainerOptions.fallbackOnErrors)
                throw error;
        }
    }
    exports.defaultContainer.unbind(someClass);
}
exports.removeFromContainer = removeFromContainer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGFpbmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vbGliL2NvbnRhaW5lci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQW1CQTs7O0dBR0c7QUFDVSxRQUFBLGdCQUFnQixHQUFpRixJQUFJLENBQUM7SUFBQTtRQUN2RyxjQUFTLEdBQXNDLEVBQUUsQ0FBQztJQWlCOUQsQ0FBQztJQWZHLEdBQUcsQ0FBSSxTQUFzQztRQUN6QyxJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEtBQUssU0FBUyxDQUFDLENBQUM7UUFDNUUsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNYLFFBQVEsR0FBRyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLElBQUksU0FBUyxFQUFFLEVBQUUsQ0FBQztZQUN4RCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUNqQztRQUVELE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQztJQUMzQixDQUFDO0lBQ0QsTUFBTSxDQUFJLFNBQXVCO1FBQzdCLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLElBQUksS0FBSyxTQUFTLENBQUMsQ0FBQztRQUM1RSxJQUFJLEdBQUcsSUFBSSxDQUFDLEVBQUU7WUFDVixJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDakM7SUFDTCxDQUFDO0NBQ0osQ0FBQyxFQUFFLENBQUM7QUFFTCxJQUFJLGFBQTJGLENBQUM7QUFDaEcsSUFBSSxvQkFBbUQsQ0FBQztBQUV4RDs7R0FFRztBQUNILHNCQUE2QixZQUEwRixFQUFFLE9BQTZCO0lBQ2xKLGFBQWEsR0FBRyxZQUFZLENBQUM7SUFDN0Isb0JBQW9CLEdBQUcsT0FBTyxDQUFDO0FBQ25DLENBQUM7QUFIRCxvQ0FHQztBQUVEO0lBQ0ksT0FBTyxhQUFhLEtBQUssU0FBUyxDQUFDO0FBQ3ZDLENBQUM7QUFGRCx3Q0FFQztBQUVEOztHQUVHO0FBQ0gsMEJBQW9DLFNBQXFCO0lBQ3JELElBQUksYUFBYSxFQUFFO1FBQ2YsSUFBSTtZQUNBLE1BQU0sUUFBUSxHQUFHLGFBQWEsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDOUMsSUFBSSxRQUFRO2dCQUNSLE9BQU8sUUFBUSxDQUFDO1lBRXBCLElBQUksQ0FBQyxvQkFBb0IsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFFBQVE7Z0JBQ3ZELE9BQU8sUUFBUSxDQUFDO1NBRXZCO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDWixJQUFJLENBQUMsb0JBQW9CLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxnQkFBZ0I7Z0JBQy9ELE1BQU0sS0FBSyxDQUFDO1NBQ25CO0tBQ0o7SUFDRCxPQUFPLHdCQUFnQixDQUFDLEdBQUcsQ0FBSSxTQUFTLENBQUMsQ0FBQztBQUM5QyxDQUFDO0FBaEJELDRDQWdCQztBQUVEOztHQUVHO0FBQ0gsNkJBQXVDLFNBQXFCO0lBQ3hELElBQUksYUFBYSxFQUFFO1FBQ2YsSUFBSTtZQUNBLGFBQWEsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7U0FDbkM7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNaLElBQUksQ0FBQyxvQkFBb0IsSUFBSSxDQUFDLG9CQUFvQixDQUFDLGdCQUFnQjtnQkFDL0QsTUFBTSxLQUFLLENBQUM7U0FDbkI7S0FDSjtJQUNELHdCQUFnQixDQUFDLE1BQU0sQ0FBSSxTQUFTLENBQUMsQ0FBQztBQUMxQyxDQUFDO0FBVkQsa0RBVUMifQ==